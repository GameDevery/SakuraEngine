# Timeline Phase Stress Tests

è¿™ä¸ªç›®å½•åŒ…å«äº†ä¸¤ä¸ªç»¼åˆæ€§çš„æµ‹è¯•ç¨‹åºï¼Œç”¨äºéªŒè¯ TimelinePhase çš„ç¨³å®šæ€§å’Œæ­£ç¡®æ€§ã€‚

## æµ‹è¯•ç¨‹åº

### 1. timeline_stress_test.cpp - åŸºç¡€å‹åŠ›æµ‹è¯•
æ¨¡æ‹Ÿä¸€ä¸ªå¤æ‚çš„å»¶è¿Ÿæ¸²æŸ“ç®¡çº¿ï¼ŒåŒ…å«ï¼š
- **å‡ ä½•é€šé“**: Shadow Map + G-Buffer æ¸²æŸ“
- **å¼‚æ­¥è®¡ç®—**: è§†é”¥å‰”é™¤ã€ç²’å­æ¨¡æ‹Ÿã€ç‰©ç†æ¨¡æ‹Ÿ
- **å…‰ç…§è®¡ç®—**: å»¶è¿Ÿå…‰ç…§ï¼ˆæ··åˆGraphicså’ŒComputeï¼‰
- **æ‹·è´æ“ä½œ**: ç‹¬ç«‹çš„çº¹ç†æ‹·è´ï¼ˆCopyé˜Ÿåˆ—ï¼‰
- **åå¤„ç†**: Bloom + Tone Mapping + UI
- **æœ€ç»ˆè¾“å‡º**: Present Pass

**é¢„æœŸç»“æœ**:
- Graphicsé˜Ÿåˆ—: 5ä¸ªPassï¼ˆRender + Presentï¼‰
- AsyncComputeé˜Ÿåˆ—: 3-5ä¸ªPassï¼ˆç‹¬ç«‹è®¡ç®—ï¼‰
- Copyé˜Ÿåˆ—: 2ä¸ªPassï¼ˆç‹¬ç«‹æ‹·è´ï¼‰
- è·¨é˜Ÿåˆ—åŒæ­¥: 2-4ä¸ªåŒæ­¥éœ€æ±‚

### 2. advanced_timeline_test.cpp - é«˜çº§åœºæ™¯æµ‹è¯•
åŒ…å«5ä¸ªä¸“é—¨çš„æµ‹è¯•åœºæ™¯ï¼š

#### æµ‹è¯•1: å¤§é‡å¹¶è¡Œè®¡ç®— (Massively Parallel)
- 20ä¸ªç‹¬ç«‹è®¡ç®—Pass + 1ä¸ªGraphics Pass
- éªŒè¯å¼‚æ­¥è®¡ç®—é˜Ÿåˆ—çš„å¹¶è¡Œè°ƒåº¦èƒ½åŠ›

#### æµ‹è¯•2: æ·±åº¦ä¾èµ–é“¾ (Deep Dependency Chain)
- Graphics â†’ Compute â†’ Graphics â†’ Compute ä¾èµ–é“¾
- éªŒè¯è·¨é˜Ÿåˆ—åŒæ­¥çš„æ­£ç¡®æ€§

#### æµ‹è¯•3: æ··åˆå·¥ä½œè´Ÿè½½ (Mixed Workload)
- 10ä¸ªRender + 15ä¸ªCompute + 5ä¸ªCopy Pass
- éªŒè¯å¤šé˜Ÿåˆ—è´Ÿè½½å‡è¡¡

#### æµ‹è¯•4: èµ„æºå¯†é›†å‹ (Resource Heavy)
- 50ä¸ªçº¹ç† + 30ä¸ªç¼“å†²åŒº + 25ä¸ªéšæœºPass
- éªŒè¯å¤§é‡èµ„æºæƒ…å†µä¸‹çš„è°ƒåº¦ç¨³å®šæ€§

#### æµ‹è¯•5: è¾¹ç¼˜æƒ…å†µ (Edge Cases)
- ç©ºRenderGraph
- åªæœ‰Present Pass
- ç¦ç”¨æ‰€æœ‰å¼‚æ­¥é˜Ÿåˆ—
- éªŒè¯æç«¯æƒ…å†µä¸‹çš„é²æ£’æ€§

## è¿è¡Œæ–¹æ³•

### æ„å»º
```bash
# åŸºç¡€å‹åŠ›æµ‹è¯•
dotnet run SB build --target timeline-stress-test --mode debug

# é«˜çº§åœºæ™¯æµ‹è¯•
dotnet run SB build --target advanced-timeline-test --mode debug
```

### æ‰§è¡Œ
```bash
# åŸºç¡€æµ‹è¯•
.build/clang/debug/bin/timeline-stress-test

# é«˜çº§æµ‹è¯•
.build/clang/debug/bin/advanced-timeline-test
```

## å…³é”®éªŒè¯ç‚¹

### âœ… è°ƒåº¦æ­£ç¡®æ€§
- [ ] Passç±»å‹æ­£ç¡®åˆ†é…åˆ°å¯¹åº”é˜Ÿåˆ—
- [ ] Present/Render Passå¼ºåˆ¶Graphicsé˜Ÿåˆ—
- [ ] æ— Graphicsä¾èµ–çš„Compute Passåˆ†é…åˆ°AsyncCompute
- [ ] æ ‡è®°ä¸ºloneçš„Copy Passåˆ†é…åˆ°Copyé˜Ÿåˆ—

### âœ… åŒæ­¥æ­£ç¡®æ€§
- [ ] è·¨é˜Ÿåˆ—ä¾èµ–æ­£ç¡®è¯†åˆ«
- [ ] åŒæ­¥éœ€æ±‚åŒ…å«æ­£ç¡®çš„signal/wait Pass
- [ ] æ¯ä¸ªåŒæ­¥éœ€æ±‚éƒ½åˆ†é…äº†Fenceå¯¹è±¡
- [ ] æ²¡æœ‰å¤šä½™çš„åŒæ­¥å¼€é”€

### âœ… èµ„æºç®¡ç†
- [ ] æ¯å¸§æ•°æ®æ­£ç¡®æ¸…ç†
- [ ] Fenceå¯¹è±¡æ­£ç¡®åˆ†é…å’Œé‡Šæ”¾
- [ ] å†…å­˜æ— æ³„æ¼

### âœ… è¾¹ç¼˜æƒ…å†µå¤„ç†
- [ ] ç©ºå›¾å¤„ç†
- [ ] å•Passå¤„ç†
- [ ] é˜Ÿåˆ—ç¦ç”¨å¤„ç†
- [ ] é”™è¯¯æ¢å¤

## æ€§èƒ½æŒ‡æ ‡

### å»¶è¿Ÿè¦æ±‚
- TimelinePhaseæ‰§è¡Œæ—¶é—´ < 1msï¼ˆå°è§„æ¨¡å›¾ï¼‰
- TimelinePhaseæ‰§è¡Œæ—¶é—´ < 5msï¼ˆå¤§è§„æ¨¡å›¾ï¼Œ100+ Passï¼‰

### å†…å­˜è¦æ±‚
- å³°å€¼å†…å­˜ä½¿ç”¨é‡ä¸Passæ•°é‡çº¿æ€§å¢é•¿
- å¸§é—´æ— å†…å­˜ç§¯ç´¯

### æ­£ç¡®æ€§è¦æ±‚
- æ‰€æœ‰Passéƒ½è¢«æ­£ç¡®åˆ†é…
- è·¨é˜Ÿåˆ—ä¾èµ–100%è¯†åˆ«
- åŒæ­¥ç‚¹æ•°é‡æœ€å°åŒ–

## è°ƒè¯•è¾“å‡º

æµ‹è¯•ç¨‹åºä¼šè¾“å‡ºè¯¦ç»†çš„è°ƒåº¦ç»“æœï¼ŒåŒ…æ‹¬ï¼š
- ğŸ“… é˜Ÿåˆ—è°ƒåº¦ä¿¡æ¯ï¼ˆæ¯ä¸ªé˜Ÿåˆ—çš„Passåºåˆ—ï¼‰
- ğŸ”„ åŒæ­¥éœ€æ±‚ï¼ˆè·¨é˜Ÿåˆ—ä¾èµ–å’ŒFenceåˆ†é…ï¼‰
- ğŸ“Š Passåˆ†é…ç»Ÿè®¡ï¼ˆGraphics/Compute/Copyåˆ†å¸ƒï¼‰

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **ç¼–è¯‘é”™è¯¯**: ç¡®è®¤SkrRenderGraphæ¨¡å—å·²æ­£ç¡®æ„å»º
2. **è¿è¡Œæ—¶å´©æºƒ**: æ£€æŸ¥Passåˆ›å»ºè¿‡ç¨‹ä¸­çš„èµ„æºå¼•ç”¨
3. **è°ƒåº¦å¼‚å¸¸**: æŸ¥çœ‹æ—¥å¿—ä¸­çš„é˜Ÿåˆ—èƒ½åŠ›æ£€æµ‹ç»“æœ

### è°ƒè¯•æŠ€å·§
1. ä½¿ç”¨`dump_timeline_result()`æŸ¥çœ‹è¯¦ç»†è°ƒåº¦ä¿¡æ¯
2. æ£€æŸ¥`SKR_LOG_DEBUG`è¾“å‡ºçš„é˜Ÿåˆ—èƒ½åŠ›
3. éªŒè¯åŒæ­¥éœ€æ±‚ä¸­çš„Fenceåˆ†é…

## æ‰©å±•æµ‹è¯•

å¯ä»¥é€šè¿‡ä¿®æ”¹ä»¥ä¸‹å‚æ•°æ¥åˆ›å»ºæ›´å¤æ‚çš„æµ‹è¯•åœºæ™¯ï¼š
- Passæ•°é‡å’Œç±»å‹æ¯”ä¾‹
- èµ„æºå¤§å°å’Œæ•°é‡
- ä¾èµ–å…³ç³»å¤æ‚åº¦
- é˜Ÿåˆ—é…ç½®ï¼ˆå¯ç”¨/ç¦ç”¨å¼‚æ­¥é˜Ÿåˆ—ï¼‰

è¿™äº›æµ‹è¯•ç¡®ä¿TimelinePhaseåœ¨å„ç§çœŸå®å’Œæç«¯åœºæ™¯ä¸‹éƒ½èƒ½æ­£ç¡®å·¥ä½œï¼Œä¸ºæ•´ä¸ªRenderGraph Phaseç³»ç»Ÿæä¾›å¯é çš„è°ƒåº¦åŸºç¡€ã€‚